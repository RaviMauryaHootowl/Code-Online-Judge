<!DOCTYPE html>
<html lang="en">
<head>
<title>ACE in Action</title>
<style type="text/css" media="screen">
    #editor { 
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        font-size: 20px;
    }
    .runBtn{
      position: absolute;
      bottom: 0;
      right: 0;
      z-index: 3;
      padding: 5px;
    }
    .code{
      position: absolute;
      bottom: 0;
      right: 0;
      z-index: 3;
      padding: 5px;
    }
</style>
</head>
<body>

<div id="editor"></div>
<button class="runBtn">Run</button>
<div class="code"></div>
    
<script src="./ace-builds-master/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/dracula");
    editor.session.setMode("ace/mode/python");

    async function postData(url = '', data = {}) {
      // Default options are marked with *
      const response = await fetch(url, {
        method: 'POST', // *GET, POST, PUT, DELETE, etc.
        mode: 'cors', // no-cors, *cors, same-origin
        cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
        credentials: 'same-origin', // include, *same-origin, omit
        headers: {
          'Content-Type': 'application/json'
          // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        referrerPolicy: 'no-referrer', // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
        body: JSON.stringify(data) // body data type must match "Content-Type" header
      });
      return response.json(); // parses JSON response into native JavaScript objects
    }

    document.querySelector('.runBtn').onclick = () => {
      alert(editor.getValue());
      postData('http://localhost:5000/api/code', { code: editor.getValue() })
        .then(data => {
          alert(data['stdout']);
          console.log(data);
        });
    }
</script>
</body>
</html>